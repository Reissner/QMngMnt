
\RequirePackage[l2tabu, orthodox]{nag}

\documentclass[a4paper,12pt]{article}

\usepackage{listings}
\input{header.tex}

\hypersetup{
  pdfinfo={
    Author   = {Ernst Reissner},
    Title    = {On writing \LaTeX{} documents for the simuline organization},
    Subject  = {quality documentation supported by latex plugin for maven},
    Keywords = {quality;PDF;LaTeX;maven}
  }
}

% \synctex=1

% \usepackage{geometry}%, showframe
% \usepackage{microtype}
% %\usepackage[utf8]{inputenc}
% %\usepackage[T1]{fontenc}

% \usepackage{listings}

% \usepackage{hyperref}
% \usepackage{rerunfilecheck}





% \usepackage[toc, record]{glossaries-extra}% after hypertex

% \GlsXtrLoadResources[
%   %dual-entry-backlink={false},
%   src={glossary},
%   sort={en-GB}
% ]


\newcommand{\siteref}[2]{\href{http://www.simuline.eu/QualityManagement/#1}{#2}}
\newcommand{\manref}[2]{\href{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#1}{#2}}

\newcommand{\pkg}[1]{\texttt{#1}\index{package #1}}
\newcommand{\cmd}[1]{\texttt{\textbackslash #1}\index{command \textbackslash #1}}
\newcommand{\tool}[1]{\texttt{#1}\index{tool #1}}
\newcommand{\file}[1]{\texttt{#1}\index{file #1}}

%\bibliographystyle{abstract}%{alpha}%{aaai-named}%
%\bibliographystyle{alpha}

\title{On writing \LaTeX{} documents for the simuline organization}
\author{Dr.~Ernst Rei√üner}
\date{\today}

\begin{document}

\maketitle


\newpage

\tableofcontents % to create file .toc
% \listoffigures
% \listoftables
\lstlistoflistings%
% TBD: why the entry does not reliably occur? 
\newpage 

\section{Introduction}

This document contains rules how to write documents specifically in \LaTeX. 
Of course, all \siteref{WritingRules/writingRules.html}{general rules} 
for writing documents apply, 
but this documents focuses on aspects specific for \LaTeX{} documents. 
The rules here are mandatory for simuline organization, 
but is applicable in a broader context maybe with modifications. 

The rules are centered around the latex maven plugin, 
which is not only a build tool 
but provides a lot of \href{http://www.simuline.eu/LatexMavenPlugin/features.html}{features} 
which help in quality assurance. 
The most important feature from the point of view of quality management is, 
that the plugin detects failures and warnings so 
that if conversely the build process completes without error or warning, 
one can be sure that the result is without failure also. 
It is open source and has public \href{https://github.com/Reissner/latex-maven-plugin}{development site}. 
At time of this writing, the current version is 2.0.0. 
Although it is the best version so far, 
it is not satisfactory still. 


At the current stage, this document is only a torso. 
%Its purpose is to check whether the overall bibliography is usable. 


\section{Installation and configuration}\label{sec:instConfig}



The installation scripts described in the context of 
\siteref{installation.html}{installation in general} ensure 
that \LaTeX{} packages and the tools released for documentation are installed. 
Among these tools is also maven, but not the core tool for documentation written in \LaTeX, 
\texttt{latex-maven-plugin}, because it is loaded by maven dynamically. 
At the first sight, the plugin is a build tool, but in fact it is much more: 
In maven build phase \texttt{validate} it may inject at the TEX-root directory a bunch of files, 
the following of which are mandatory unless a justification not to use them is documented: 
%
\begin{itemize}
  \item a header file \file{header.tex} 
  which shall be included in any case loading the mandatory basic packages, more packages can be loaded with justification. 
  This ensures completeness of build including rerun of converters, reliable detection of warnings, 
  unifies the documents improving their maintainability and 
  restriction to predefined headers ensures that the packages needed are installed, 
  \item a configuration file \file{.chktexrc} to configure the checker tool \tool{chktex} 
  which performs \LaTeX-specific checks and supplements \tool{ltex}, 
  \item a configuration file \file{.latexmkrc} to configure the build tool \tool{latexmk}, 
  which allows quick compilation in the course of document development 
  with the same result as the plugin. 
\end{itemize}

As described in~\cite{LatexPlugin}, \manref{\#sec:xmlPom}{Section 2.2}, 
to that end, the plugin, to be more precise its executions, must be configured accordingly, 
in particular injection with goal \texttt{inj} for at least the three injections enumerated above. 
The \href{https://github.com/Reissner/QMngMnt/pom.xml}{pom} of this project may serve as a template also. 

The installation section described above installs also the editor VS Code 
and provides a script \file{instVScode.sh} to install all needed extensions. 
This script invokes another script provided by the latex plugin 
installing the extensions for writing \LaTeX{} documents. 
Thus, the latter script need not be invoked explicitly. 

It is worth reading the whole section on injections,%\
~\cite{LatexPlugin}, \manref{\#sec:injFiles}{Section 3.4}, 
for example to see how much the injected files are related, 
but minimally, to make \tool{chktex} and \tool{latexmk} work, 
add links from local config files \file{.chktexrc} and \file{.latexmkrc} to the central injected ones. 
% TBD: hm, this looks odd. 
% very noble would be if the plugin detects the file. If present ok, invoke chktex or latexmk without further ado. 
% if not present, check whether the .xxxrc file is present in the root. 
% if not: warning: not reproducible 
% if so, use this with according parameters for loading it. 

Besides the editor, also the viewer, above all \tool{Okular} is installed. 
The latex plugin used as a build tool, merely invokes converters in a sensible ordering. 
All these are installed, and among these also \tool{chktex} and \tool{latexmk}. 
As described also in~\cite{LatexPlugin}, Section 2.2, 
among the configuration is a list of \texttt{targets}. 
Typically, \texttt{pdf} is among the targets, but it may also be \texttt{html}, 
which is still to be used with care in the current version of the latex plugin 2.x.y. 
What is mandatory is target \texttt{chk} invoking \tool{chktex} for final check. 
Except for \texttt{targets}, it is recommended to stick to the default configuration 
at least for final build because this is ``preferred usage'' and thus best tested. 

In contrast to \tool{chktex}, the latex plugin does not invoke \tool{latexmk} directly, 
at least not by default, but it increases productivity during document development 
to configure it with a file \file{.latexmkrc}. 
For further reading see~\manref{\#sec:devel}{Section 3.5}. 


%TBD\@: think about how to reference documents in Markdown format. 


\section{The {\LaTeX} files}\label{sec:latexFiles}

Listing~\ref{lst:thisLatexFile} is a listing of the beginning of this file. 
This is an example of an allowed \LaTeX{} main file, i.e.\@ a file to be compiled (not included). 
For general thoughts see~\cite{LatexPlugin},~\manref{\#subsec:sourcesLatex}{Section 3.1.1}. 

The central is the definition of the document class. 
So far only classes \texttt{book}, \texttt{article} and \texttt{beamer} are tested sufficiently. 
Note that files with beamer class have a special form treated in the manual. 
Also, the options allowed for document classes vary. 
Except for \texttt{beamer}, for which \texttt{aspectratio} may be set, 
\texttt{a4paper} format is mandatory and deviation must be justified. 
For beamer class, no font size shall be specified. 
In general, the default 10pt is a good choice, 
but in special cases other font sizes like 12pt may be specified. 
It is no error that class \texttt{beamer} requires option \texttt{hyperref=destlabel}. 
Note that \texttt{beamer} documents shall comprise the proper presentation but also a handout. 
The technique to use is the one given in~\cite{LatexPlugin},~Section 3.1.1. 

% TBD: here also the language if not english, american? must be specified as a sequence. 
% TBD: clarify why in beamer we have destlabel set. 

The declaration of the document class may be preceded by a lot of material, 
but mandatory is loading \pkg{nag} with the given options. 

At least input \file{header.tex} must be loaded, 
or a justification must be documented for deviating from the default. 
More packages can be loaded if really needed 
and commands can be defined before and after including the mandatory header. 
Note that paper format is processed by package \pkg{geometry} 
and \file{header.tex} ensures proper loading. 

To provide minimal metadata, Author, Title, Subject and keywords, 
use command \cmd{hypersetup} as in Listing~\ref{lst:thisLatexFile}. 
This is provided by package \pkg{hyperref} also loaded in \file{header.tex}. 


\lstinputlisting[linerange={1-15},
language=tex, basicstyle=\scriptsize,
float, captionpos=b, label={lst:thisLatexFile}, 
caption={The beginning of this \LaTeX{} file. }]%
{./howToLatex.tex}% listing 


% %
% \begin{description}
%   \item[mandatory] 
%   \pkg{geometry}, \pkg{microtype}, \pkg{rerunfilecheck}, 
%   \pkg{listings}, \pkg{hyperref}. 
%   The package \pkg{hyperref} must be used, among others, with option \texttt{destlabel} 
%   as explained in Section~\ref{sec:secs}. 
%   This listing is incomplete. 
%   \item[future] In future \pkg{biblatex} is mandatory. 
%   It shall be used in conjunction with \tool{biber}. 

%   In general, a glossary is needed. Currently, \pkg{makeglossaries} is required, 
%   in future it shall be \pkg{glossaries-extra} instead. 
%   The tool tied to \tool{makeglossaries} has the same name 
%   and shall be replaced by \tool{bib2gls} tied to \tool{makeglossaries}. 

%   Once, it shall be evaluated whether \tool{xindy} is superior to \tool{makeindex} 
%   in which case it shall be replaced. 

%   Since unification is a vital principle, in general documentation is in American English language. 
%   Nevertheless, earlier or later there is a need for further languages. 
%   Thus, the package \pkg{babel} is required. 
%   % a few words on hen to load the language. 
% \end{description}



\section{Sections and other structures}\label{sec:secs}

Each document needs a title, an author, 
a date and an identification of the version of the document. 
Title and related must be specified in the header, i.e.\@ not in the \texttt{document} environment. 
In contrast, \cmd{maketitle} must be in that environment. 

If a document refers to software, as e.g\@. a manual, 
the version of the document is that of the software. 
Currently, reproducibility checks of a created PDF file is not required, 
but if so, this is ensured as described 
in the according section of the \manref{\#sec:chkReprod}{manual}. 

Each document requires a table of contents. 
If there are figures, tables or listings, then also an according table, 
e.g.\@ table of figures, is required. 

All documents shall have a bibliography, an index and a glossary. 
Each of them must have an entry in the table of contents. 
This document is an exception in that it has no glossary. 
The reason is that in short time, a new mechanism for glossaries is introduced, 
so it is not worth to endow this document with an old style glossary now. 
This applies to all other documents which do not have a glossary at present. 

An introductory section is mandatory and in most cases, 
it is advisable to have a summary or a miscellaneous section, 
or a section with open points. 

Each section, no matter which level, i.e.\@ applies also to chapters in books, 
is numbered and has a label for reference. 
If it has subsections, it has some introducing text mentioning all immediate subsections 
and reference them. 

Also figures, tables and listings are labeled and must be referenced at least once. 

Note that the \file{header.tex} mentioned in Section~\ref{sec:instConfig} 
loads the package \pkg{hyperref} with at least the option \texttt{destlabel}. 
This defines for all labels destinations with the same name. 
This allows to access sections and floating structures 
of PDF document on the internet. 
For example, the manual of the latex plugin 
is located at \url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf}. 
Its chapter on installation has label \texttt{chap:install}, 
so this chapter is accessible 
via the destination with the same name 
tied to the URL 
\url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#chap:install}. 

The command \texttt{\textbackslash href\{url\}\{text\}} 
allows referencing PDF files and structures therein directly. 
Clicking on the URL or on the text label in the PDF file opens the linked resource. 

A last feature the PDF format offers are meta-data. 
See Section~\ref{sec:latexFiles} for how to set up meta-data. 



\section{Miscellaneous}\label{sec:misc}

A big subject is how to obtain reproducible documents. 
Also documents which contain computed data, either figure or computed pictures. 
A discussion on \tool{pythontex} and package \pkg{pythontex} can be found in~\cite{Poo15}. 
We are lucky that \pkg{pythontex} allows computations in python but also in octave, 
i.e.\@ in the MATLAB language,  
the two major languages we use besides our developing language java. 



\subsection{How to deal with ltex}\label{subsec:ltex}

Ltex has many rules, but there is one particular, which is difficult to conform with. 
It is about spacing. 

The root of the problem is, that \LaTeX{} inserts more space after full stop, 
but not after other dot followed by a space. 
But how does \LaTeX{} decide this? If the dot is preceded by a lower case letter, 
then it assumes a full stop, after an upper case letter it assumes no full stop. 
This rule applies in most cases but not in all. 
Here are two examples: 
%
\begin{itemize}
  \item ``Apple Inc. sells phones''% chktex 12
  Here, \LaTeX{} thinks the period ends a sentence and wrongly adds an extra space.
  \item ``My school scores were all A. Einstein would be proud of me''
  Here, \LaTeX{} does not realize that the period ends a sentence 
  and does not add the expected space. 
  Note that \tool{chktex} does not find this problem. 
\end{itemize}

The problem is solved by adding an invisible lower case letter by \texttt{\textbackslash\@}. 
% TBD: why does index not work? maybe better with bibier. \index{\textbackslash\@}%\cmd{\@}. 
Note how spacing improves: 
%
\begin{itemize}
  \item ``Apple Inc.\@ sells phones''
  \item ``My school scores were all A\@. Einstein would be proud of me''
\end{itemize}

\subsection{The various kinds of dashes}\label{subsec:dashes}

An overview is given in 
\url{https://site.uit.no/english/punctuation/hyphen/}. 
TBD\@: make this more explicit. 
Mention \tool{chktex}. 

\subsection{Terminology Management, Glossaries}\label{subsec:glos}

Terminology management means that basic terms are defined at a single source. 
It is decided that this places is a file in BIB format read by \tool{bib2bls}. 
This cooperates with \LaTeX{} via package \pkg{glossaries-extra}. 
It is conceivable to have more than one of these BIB files, 
but each term must be defined once over all BIB files. 

This is a mandatory feature not yet realized in the latex plugin. 

% A very good example of how useful and necessary terminology management is, 
% are the terms \gls{precN} and \gls{accN} referring to numbers 
% versus \gls{precM} and \gls{accM} referring to measurement. 

\subsection{Citations}

When citing from a source, this must be done with the \cmd{cite} 
command specifying the document following the chapter or section or other structure, 
like listing, table or figure. 

Sometimes it is advantageous to add a link to the according PDF file 
if this is accessible via internet/intranet. 
As an example let us consider \url{https://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf}
To reference a specific structure, 
one shall use so-called destinations as described in~\cite{Pdf17}, 
Section 12.3.2.3. 
Unfortunately, there is no specification on the names of the destinations 
referring to structures 
although \texttt{chap.1} is widely used to specify the beginning of chapter 1. 
Only references to pages are specified. 
Fortunately, the destinations of a document \file{manualLMP.pdf} 
are listed via \texttt{pdfinfo -dests manualLMP.pdf}. 
If a document is created with \LaTeX{} using package \pkg{hyperref} 
with option \texttt{destlabel} as prescribed in Section~\ref{sec:secs}, 
then the labels are destinations. 
As an example, \file{manualLMP.pdf} has a chapter 4 with label \texttt{chap:GraphConversions}
and so \url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#chap:GraphConversions} 
points to the beginning of that chapter. 

\subsection{Relation to other documentation systems}

Here are important: 
`markdown': how to include markdown in a \LaTeX{} file and the other way round. 
jupyter notebooks: `jupynotex'
and good old `texinfo'. 


\section{Features to be added}\label{sec:features}

\pkg{babel} package must be preloaded in \file{header.tex}. 
The start of \LaTeX{} files must be generalized thus (\cmd{documentclass} may have language setting). 
Maybe we do not have all document classes which are relevant. 
Think of letters and leaflets. 

Traditional glossaries must be replaced by \pkg{glossaries-extra} in conjunction with \tool{bib2gls}. 
Also, \pkg{biblatex} must be loaded in \file{header.tex} and \tool{biber} must be usable. 

Finally, \file{header.tex} must be cleaned up. 


In the long run, the plugin shall also check the loaded packages, 
including their versions. 
This is important as the design goal to detect all warnings 
can be reached only if the used packages are taken into account 
when parametrizing the regular expression to detect a warning. 



%\printunsrtglossaries%
\printindex
\bibliographystyle{alpha}
\bibliography{litPublic,litLMPpub}

\end{document}