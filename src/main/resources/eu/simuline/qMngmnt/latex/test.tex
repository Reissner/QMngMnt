
\RequirePackage[l2tabu, orthodox]{nag}

\documentclass[a4paper,12pt]{article}
\synctex=1

\usepackage{geometry}%, showframe
\usepackage{microtype}
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}

\usepackage{listings}

\usepackage{hyperref}
\usepackage{rerunfilecheck}

\usepackage[toc, record]{glossaries-extra}% after hypertex

\GlsXtrLoadResources[
  %dual-entry-backlink={false},
  src={../glossary},
  sort={en-GB}
]

\bibliographystyle{abstract}%{alpha}%{aaai-named}%
%\bibliographystyle{alpha}

\title{On writing \LaTeX{} documents for the simuline organization}
\author{Dr.~Ernst Rei√üner}
\date{\today}

\begin{document}

\maketitle


\newpage

\tableofcontents % to create file .toc
\listoffigures
\listoftables
%\newpage

\section{Introduction}

This document contains rules how to write documents specifically in \LaTeX. 
Of course all rules for writing documents apply (TBD\@: reference) 
and this documents focuses on aspects specific for latex documents. 
The rules here are followed for simuline organization, 
but is applicable in a broader context maybe with modifications. 

At the current stage, this document is only a torso. 
Its purpose is to check whether the overall bibliography is usable. 


\section{Tools}\label{sec:tools}

\LaTeX{} is a compiled language. 
Thus, one needs an editor, possibly with an according \LaTeX-extension, 
the proper compiler and a viewer for each output format. 

As an editor \texttt{Emacs} with extension \texttt{AUCTeX} 
is a possible choice, but we chose visual \texttt{code} with an according extension. 
TBD\@: add a reference to the installation script for \texttt{code}. 
The main viewer is \texttt{Okular} but also \texttt{chrome} with markdown extension (TBD\@: which) 
is needed. 
What makes latex difficult from a point of view of tooling is, 
that there is not a single converter but a universe of related tools, 
e.g.\@ to make a bibliography or an index, 
and also latex itself must be enriched loading appropriate packages. 

TBD\@: add reference to the installation script \texttt{Zypper} 
and installation script for visual code extensions, among them also those for latex. 
TBD\@: think about how to reference documents in Markdown format. 


As \texttt{maven} is the general build tool, we bundle all those converters 
in a single maven plugin which does nothing but invoking converters by need. 
For our special needs, we developed the 
\href{https://github.com/Reissner/latex-maven-plugin}{\texttt{latex-maven-plugin}}. 
Starting from version 1.5, it has a goal \texttt{vrs} listing all converters 
with their applicable versions. 
It is recommended to have all of them installed. 
In addition, there are lots of latex-packages required, 
all of them in the \texttt{texlife} distribution 
which contains also most of the converters, but not all of them. 
The site of the plugin gives hints on the pieces of software used by the plugin 
and provides a manual covering the full functionality. 

What is important from the point of view of quality management is, 
that the plugin detects failures and warnings so 
that if conversely the build process completes without error or warning, 
one can be sure that the result is without failure also. 
Another point is that the plugin is for building all documents in one build run 
but supports also development of a single document. 
Maybe the most widely used tool for development of a single \LaTeX{} document 
is \texttt{latexmk} and the plugin is designed to cooperate with \texttt{latexmk}, 
switching to \texttt{latexmk} if an error occurs or if a section must be added 
and then again switching back to the plugin if all documents shall be complied. 
Starting with version 2.0, 
the \href{https://github.com/Reissner/latex-maven-plugin}{\texttt{latex-maven-plugin}} 
has also a goal \texttt{inj} for injecting files. 
If properly configured (TBD\@: reference) it creates a file \texttt{.latexmkrc} 
which defines a configuration for \texttt{latexmk} 
and which is in line with the options used for the latex plugin. 
An important tool both for quality assurance and for document development 
is the linter \texttt{chktex} with its configuration file \texttt{.chhktexrc}. 
Also, this can be created with goal \texttt{inj} 
so that it is equivalent whether running \texttt{chktex} or through the plugin. 
The goal \texttt{inj} can and shall also be used to inject a header \texttt{header.tex} 
to load the required packages. 
Each latex main file shall use this header 
to unify the documents style and to make them more maintainable. 
In fact, one may deviate from this rule only with justification. 

In the long run, the plugin shall also check the loaded packages, 
including their versions. 
This is important as the design goal to detect all warnings 
can be reached only if the used packages are taken into account 
when parametrizing the regular expression to detect a warning. 

Note that the plugin also provides a script 
to install extensions for VS code useful for developing latex documents. 
This is not created by goal \texttt{inj}, 
in fact it is not used directly. 
Instead, this project provides the script \texttt{instVScode.sh} 
to install a wider range of extensions. 
The script provided by the latex plugin 
goes into this but need not be invoked explicitly. 






In the long run, 
all projects, even this one shall use the \texttt{latex-maven-plugin}. 
This is currently not possible because this would introduce a cyclic dependency, 
because on the one hand, the latex plugin is subject to the rules 
prescribed in this quality management project 
and must be referenced in the latex plugin project, 
and on the other hand, 
this quality management project needs the plugin to build. 
This can only be resolved if this one project 
refers to a lower version of the sibling project. 
At the beginning, this is not possible. 
In general, compilation should work with default parameters. 

For now, this document is generated locally 
only using command line tools \texttt{lualatex} and \texttt{bibtex} 
(in future we will require \texttt{biber} which presupposes the package \texttt{biblatex}). 
Later we require a glossary and an index, glossary with \texttt{bib2gls} 
and an index, where the tooling is not yet so clear. 
Instead of directly using the combination of these tools, 
one could use \texttt{latexmk} 
with an appropriate config file \texttt{.latexmkrc} created by the plugin. 

\subsection{Configuration of tools and \LaTeX{} packages}\label{subsec:toolConf}

This section collects configuration of \TeX{} documents. 
A big part of configuration is the set of packages used 
and the options of the packages. 
Note that these packages partially presuppose the abovementioned tools. 
These tools are mandatory also in other cases for sake of reproducibility. 

Some packages must be loaded before declaration of the \texttt{documentclass}. 
This document is just an example. 

\lstinputlisting[firstline=2, lastline=2]{test}%\RequirePackage

Then comes the declaration of the \texttt{documentclass}. 
Currently, we support the classes \texttt{article}, \texttt{book} and \texttt{beamer}. 
Since this is a (western) European company, only a4 paper is supported, 
of course except \texttt{beamer} for which \texttt{aspectratio} may be set. 
The format shall be provided by the package \texttt{geometry}, 
but the option shall be given not as package option but as \texttt{documentclass} option 
to make it available to other packages also. 
Font size of 12pt shall be in general used. 

\lstinputlisting[firstline=4, lastline=4]{test}%\documentclass

It is a requirement to support ``document development''. 
This includes making a development environment as much 
WYSIWIG\footnote{What you see is what you get}-like as possible. 
To that end, one shall activate \texttt{synctex} as follows 

\lstinputlisting[firstline=5, lastline=5]{test}%\documentclass


After that, in the long run further packages shall be input from a general header file. 
If an auxiliary tool cooperates with the package, 
this is mentioned in the sequel. 
In the time to be, we specify here the packages needed and prohibited: 
%
\begin{description}
  \item[prohibited] 
  \texttt{inputenc}, 
  \texttt{fontenc} because these do not fit \texttt{lualatex}. 
  \item[mandatory] 
  \texttt{geometry}, \texttt{microtype}, \texttt{rerunfilecheck}, 
  \texttt{listings}, \texttt{hyperref}. 
  The package \texttt{hyperref} must be used, among others, with option \texttt{destlabel} 
  as explained in Section~\ref{sec:secs}. 
  This listing is incomplete. 
  \item[future] In future \texttt{biblatex} is mandatory. 
  It shall be used in conjunction with \texttt{biber}. 

  In general, a glossary is needed. Currently, \texttt{makeglossaries} is required, 
  in future it shall be \texttt{makeglossaries-extra} instead. 
  The tool tied to \texttt{makeglossaries} has the same name 
  and shall be replaced by \texttt{bib2gls} tied to \texttt{makeglossaries}. 

  Once, it shall be evaluated whether \texttt{xindy} is superior to \texttt{makeindex} 
  in which case it shall be replaced. 

  Since unification is a vital principle, in general documentation is in American English language. 
  Nevertheless, earlier or later there is a need for further languages. 
  Thus, the package \texttt{babel} is required. 
  % a few words on hen to load the language. 
\end{description}

In the future, the latex plugin shall provide header files to unify the loaded packages. 
% Header is almost transparent concering the latex compiler. 

% nothing said about use of chktex and latexmk and in particular files .chktexrc and .latexmkrc. 
% how to set up. 
% also missing are metadata in PDF. 
% what about ps or dvi? not used. Only PDF. in the long run also DOCX, HTML and EPUB. 
% a word on the latex plugin and its version. 
% also using the default and deviation: injections. 

\section{Sections and other structures}\label{sec:secs}

Each document needs a title, an author, 
a date and an identification of the version of the document.  
If a document refers to software, as e.g\@. a manual, 
the version of the document is that of the software. 
Currently, reproducibility checks of a created PDF file is not required, 
but if so, this is ensured as described 
in the according section of the 
\href{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#sec:chkReprod}{manual}. 

Each document requires a table of contents. 
If there are figures, tables or listings, then also an according table, 
e.g.\@ table of figures, is required. 

All documents shall have a reference, an index and a glossary. 
Each of them must have an entry in the table of contents. 

An introductory section is mandatory and in most cases, 
it is advisable to have a summary or a miscellaneous section, 
or a section with open points. 

Each section, no matter which level, i.e.\@ applies also to chapters in books, 
is numbered and has a label for reference. 
If it has subsections, it has some introducing text mentioning all immediate subsections 
and reference them. 

Also figures, tables and listings are labeled and must be referenced at least once. 

Note that it is mandatory to use the package \texttt{hyperref} 
with at least the option \texttt{destlabel}. 
This defines for all labels destinations with the same name. 
This allows to access sections and floating structures 
of PDF document on the internet. 
For example, the manual of the latex plugin 
is located at \url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf}. 
Its chapter on installation has label \texttt{chap:install}, 
so this chapter is accessible 
via the destination with the same name 
tied to the URL 
\url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#chap:install}. 


\section{Miscellaneous}\label{sec:misc}

A big subject is how to obtain reproducible documents. 
Also documents which contain computed data, either figure or computed pictures. 
A discussion on \texttt{pythontex} can be found in~\cite{Poo15}. 
We are lucky that \texttt{pythontex} allows computations in python but also in octave, 
i.e.\@ in the MATLAB language,  
the two major languages we use besides our developing language java. 

Note that there are alternatives to 


\subsection{How to deal with ltex}\label{subsec:ltex}

Ltex has many rules, but there is one particular, which is difficult to conform with. 
It is about spacing. 

The root of the problem is, that \LaTeX{} inserts more space after full stop, 
but not after other dot followed by a space. 
But how does \LaTeX{} decide this? If the dot is preceded by a lower case letter, 
then it assumes a full stop, after an upper case letter it assumes no full stop. 
This rule applies in most cases but not in all. 
Here are two examples: 
%
\begin{itemize}
  \item ``Apple Inc. sells phones''% chktex 12
  Here, \LaTeX{} thinks the period ends a sentence and wrongly adds an extra space.
  \item ``My school scores were all A. Einstein would be proud of me''
  Here, \LaTeX{} does not realize that the period ends a sentence 
  and does not add the expected space. 
  Note that \texttt{chktex} does not find this problem. 
\end{itemize}

The problem is solved by adding an invisible lower case letter by \texttt{\textbackslash@}. 
Note how spacing improves: 
%
\begin{itemize}
  \item ``Apple Inc.\@ sells phones''
  \item ``My school scores were all A\@. Einstein would be proud of me''
\end{itemize}

\subsection{The various kinds of dashes}\label{subsec:dashes}

An overview is given in 
\url{https://site.uit.no/english/punctuation/hyphen/}. 
TBD\@: make this more explicit. 
Mention \textTT{chktex}. 

\subsection{Terminology Management, Glossaries}\label{subsec:glos}

Terminology management means that basic terms are defined at a single source. 
It is decided that this places is a file in BIB format read by \texttt{bib2bls}. 
This cooperates with \LaTeX{} via package \texttt{makeglossaries-extra}. 
It is conceivable to have more than one of these BIB files, 
but each term must be defined once over all BIB files. 

A very good example of how useful and necessary terminology management is, 
are the terms \gls{precN} and \gls{accN} referring to numbers 
versus \gls{precM} and \gls{accM} referring to measurement. 

\subsection{Citations}

When citing from a source, this must be done with the \texttt{\textbackslash cite} 
command specifying the document following the chapter or section or other structure, 
like listing, table or figure. 

Sometimes it is advantageous to add a link to the according PDF file 
if this is accessible via internet/intranet. 
As an example let us consider \url{https://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf}
To reference a specific structure, 
one shall use so-called destinations as described in~\cite{Pdf17}, 
Section 12.3.2.3. 
Unfortunately, there is no specification on the names of the destinations 
referring to structures 
although \texttt{chap.1} is widely used to specify the beginning of chapter 1. 
Only references to pages are specified. 
Fortunately, the destinations of a document \texttt{manualLMP.pdf} 
are listed via \texttt{pdfinfo -dests manualLMP.pdf}. 
If a document is created with \LaTeX{} using package \texttt{hyperref} 
with option \texttt{destlabel} as prescribed in Section~\ref{sec:secs}, 
then the labels are destinations. 
As an example, \texttt{manualLMP.pdf} has a chapter 4 with label \texttt{chap:GraphConversions}
and so \url{http://www.simuline.eu/LatexMavenPlugin/manualLMP.pdf#chap:GraphConversions} 
points to the beginning of that chapter. 

\subsection{Relation to other documentation systems}

Here are important: 
`markdown': how to include markdown in a \LaTeX{} file and the other way round. 
jupyter notebooks: `jupynotex'
and good old `texinfo'. 



\printunsrtglossaries%
\bibliography{litPublic}

\end{document}